<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Avaliações</title>
    
    <!-- CDNs Externos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/heroicons@2.1.3/dist/solid/index.js" defer></script>
    
    <!-- Fontes e Estilos Locais -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📝</text></svg>">

</head>
<!-- CORREÇÃO: Removidas as classes de layout do body -->
<body class="p-4 md:p-8">

    <!-- CORREÇÃO: As classes de layout agora são controladas aqui e pelo JS -->
    <div id="main-container" class="w-full">

        <!-- TELA DE IDENTIFICAÇÃO -->
        <div id="login-screen" class="card max-w-lg mx-auto w-full">
            <h1 class="text-3xl font-bold mb-2 text-center">Plataforma de Avaliações</h1>
            <p class="text-slate-500 mb-8 text-center">Identifique-se para iniciar a sua prova.</p>
            <div class="space-y-5">
                <div>
                    <label for="year-select" class="font-semibold mb-2 block">1. Selecione seu Ano:</label>
                    <select id="year-select" class="form-select"><option value="">-- Selecione --</option></select>
                </div>
                <div>
                    <label for="class-select" class="font-semibold mb-2 block">2. Selecione sua Turma:</label>
                    <select id="class-select" class="form-select" disabled><option value="">-- Selecione o ano primeiro --</option></select>
                </div>
                <div>
                    <label for="student-select" class="font-semibold mb-2 block">3. Selecione seu Nome:</label>
                    <select id="student-select" class="form-select" disabled><option value="">-- Selecione a turma primeiro --</option></select>
                </div>
            </div>
            
            <div id="adaptation-legend" class="hidden mt-4 text-xs text-slate-500 text-center p-2 bg-slate-100 rounded-md">
                * Aluno com necessidades específicas. Uma avaliação adaptada será aplicada.
            </div>

            <div id="error-message-container" class="hidden mt-4 bg-red-100 text-red-700 p-3 rounded-lg text-sm border border-red-200"></div>
            <button id="start-btn" class="btn btn-primary w-full mt-8 text-base" disabled>
                <hero-play-solid class="w-5 h-5"></hero-play-solid>
                Iniciar Avaliação
            </button>
            <div class="text-center mt-6">
                <a href="#" id="teacher-login-link" class="text-sm text-slate-500 hover:text-blue-600 transition">Acesso do Professor</a>
            </div>
        </div>

        <!-- TELA DA AVALIAÇÃO PADRÃO -->
        <div id="quiz-screen" class="hidden w-full h-full">
            <div class="quiz-card flex-col md:flex-row gap-4">
                <div class="w-full md:w-5/12 lg:w-4/12 h-full bg-white/60 rounded-xl p-6 overflow-y-auto hidden md:block">
                    <h3 class="text-xl font-bold mb-4">Texto de Apoio</h3>
                    <div id="base-text-desktop" class="prose"></div>
                </div>
                <div class="w-full md:w-7/12 lg:w-8/12 h-full flex flex-col p-2 md:p-6">
                    <div id="student-info-display" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-slate-700 font-medium text-sm flex-shrink-0"></div>
                    <div class="flex-grow flex flex-col overflow-y-hidden">
                        <div class="overflow-y-auto pr-2 pb-4">
                            <p id="progress" class="text-sm text-slate-500 font-medium mb-2"></p>
                            <h2 id="question" class="font-bold leading-tight mt-1 text-2xl"></h2>
                        </div>
                        <div id="options-container" class="mt-auto pt-4"></div>
                    </div>
                    <div class="pt-4 flex-shrink-0">
                        <div id="feedback" class="text-base font-semibold min-h-[24px]"></div>
                        <div class="flex justify-between items-center mt-4">
                            <button id="open-sidebar-btn" class="btn btn-secondary md:hidden">
                                <hero-document-text-solid class="w-5 h-5"></hero-document-text-solid> Ver Texto
                            </button>
                            <button id="next-btn" class="btn btn-primary ml-auto">Próxima Pergunta</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="warning-message" class="hidden fixed bottom-4 right-4 bg-red-100 text-red-800 px-4 py-3 rounded-lg shadow-lg z-50">
                <strong>Atenção!</strong> Você saiu da tela da prova. Esta ação foi registrada.
            </div>
        </div>

        <!-- NOVA TELA: AVALIAÇÃO DE ARRASTAR E SOLTAR -->
        <div id="drag-drop-screen" class="hidden card max-w-4xl mx-auto w-full">
            <h1 class="text-2xl font-bold mb-1 text-center">Atividade de Associação</h1>
            <p id="drag-drop-instruction" class="text-slate-500 mb-6 text-center">Arraste cada figura para a sua sombra correta.</p>
            <div class="grid grid-cols-2 gap-8 mt-8">
                <div id="drag-items-container" class="flex flex-col items-center justify-around gap-4 p-4 bg-slate-100 rounded-lg">
                </div>
                <div id="drop-targets-container" class="grid grid-cols-2 gap-4 p-4 border-2 border-dashed border-slate-300 rounded-lg">
                </div>
            </div>
            <p id="drag-drop-feedback" class="text-center font-semibold text-lg mt-6 min-h-[28px]"></p>
            <button id="drag-drop-next-btn" class="btn btn-primary w-full mt-4 hidden">Próximo Nível</button>
        </div>
        
        <!-- TELA DE RESULTADOS -->
        <div id="results-screen" class="hidden card max-w-lg mx-auto text-center">
            <h1 class="text-3xl font-bold mb-4">Avaliação Finalizada!</h1>
            <p class="text-lg text-slate-600 mb-2">Você acertou:</p>
            <p id="score" class="text-6xl font-extrabold text-slate-800 mb-4"></p>
            <p class="text-2xl font-semibold text-slate-700 mb-8">Sua nota: <span id="decimal-score" class="text-blue-600 font-bold"></span></p>
            <p id="save-status" class="mb-6 text-sm"></p>
            <button id="back-to-start-btn" class="btn btn-primary w-full">
                <hero-arrow-left-start-on-rectangle-solid class="w-5 h-5"></hero-arrow-left-start-on-rectangle-solid>
                Voltar ao Início
            </button>
        </div>

        <!-- ÁREA DO PROFESSOR -->
        <div id="teacher-area-screen" class="hidden card max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold mb-6 text-center">Área do Professor</h1>
            <div class="space-y-6">
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-document-arrow-down-solid class="w-6 h-6 mr-3 text-blue-600"></hero-document-arrow-down-solid>
                        1. Preparar Prova Offline
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Gere e baixe um arquivo HTML autônomo da prova para ser usado nos dispositivos sem internet.</p>
                    <button id="generate-test-file-btn" class="btn btn-secondary w-full">Gerar e Baixar Arquivo</button>
                </div>
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-arrows-right-left-solid class="w-6 h-6 mr-3 text-blue-600"></hero-arrows-right-left-solid>
                        2. Sincronizar Resultados
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Exporte ou importe arquivos de resultados para sincronizar os dados locais com o sistema online.</p>
                    <div class="flex gap-4">
                        <button id="export-results-btn" class="btn btn-secondary w-1/2">Exportar</button>
                        <button id="import-results-btn" class="btn btn-secondary w-1/2">Importar</button>
                        <input type="file" id="import-file-input" class="hidden" accept=".json">
                    </div>
                     <p id="sync-status" class="text-sm text-center mt-3 text-slate-500"></p>
                </div>
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-chart-pie-solid class="w-6 h-6 mr-3 text-blue-600"></hero-chart-pie-solid>
                        3. Painel de Desempenho
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Acesse os gráficos e a lista completa de resultados de todos os alunos sincronizados.</p>
                    <button id="view-dashboard-btn" class="btn btn-primary w-full">Acessar Painel</button>
                </div>
            </div>
             <button id="back-to-start-from-teacher-area-btn" class="text-sm text-slate-500 hover:text-blue-600 mt-8 block text-center transition">Voltar</button>
        </div>

        <!-- PAINEL DO PROFESSOR -->
        <div id="teacher-dashboard" class="hidden w-full">
            <div class="card w-full max-w-screen-2xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                     <h1 class="text-3xl font-bold">Painel de Desempenho</h1>
                     <button id="back-to-teacher-area-btn" class="text-sm text-slate-500 hover:text-blue-600 transition">Voltar para Área do Professor</button>
                </div>
                <div class="flex flex-col lg:flex-row gap-4 mb-6 bg-slate-50 p-4 rounded-xl border">
                    <div class="flex-1">
                        <label for="dashboard-year-filter" class="font-semibold mb-1 block text-sm">Filtrar por Ano:</label>
                        <select id="dashboard-year-filter" class="form-select"><option value="all">Todos os Anos</option></select>
                    </div>
                     <div class="flex-1">
                        <label for="dashboard-class-filter" class="font-semibold mb-1 block text-sm">Filtrar por Turma:</label>
                        <select id="dashboard-class-filter" class="form-select"><option value="all">Todas as Turmas</option></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 p-6 rounded-xl text-center border border-blue-100">
                        <h3 class="text-lg font-semibold text-blue-800">Média Geral de Acertos</h3>
                        <p id="avg-score" class="text-4xl font-bold text-blue-900 mt-2">0%</p>
                    </div>
                    <div class="bg-green-50 p-6 rounded-xl text-center border border-green-100">
                        <h3 class="text-lg font-semibold text-green-800">Total de Provas Realizadas</h3>
                        <p id="total-assessments" class="text-4xl font-bold text-green-900 mt-2">0</p>
                    </div>
                    <div class="bg-yellow-50 p-6 rounded-xl text-center border border-yellow-100">
                        <h3 class="text-lg font-semibold text-yellow-800">Alunos Únicos Avaliados</h3>
                        <p id="total-students" class="text-4xl font-bold text-yellow-900 mt-2">0</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-xl font-bold mb-4 text-center">Análise de Acertos por Questão</h3>
                        <canvas id="question-difficulty-chart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-xl font-bold mb-4 text-center">Tempo Médio por Questão (segundos)</h3>
                        <canvas id="time-per-question-chart"></canvas>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-sm border col-span-1 lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4 text-center">Distribuição de Notas</h3>
                        <div class="max-w-md mx-auto">
                            <canvas id="score-distribution-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Resultados Individuais</h3>
                    <div class="overflow-x-auto border rounded-lg">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-sm">
                                <tr>
                                    <th class="p-3 font-semibold">Aluno</th>
                                    <th class="p-3 font-semibold">Avaliação</th>
                                    <th class="p-3 font-semibold">Nota</th>
                                    <th class="p-3 font-semibold">Duração</th>
                                    <th class="p-3 font-semibold">Data</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body" class="text-slate-600"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE CONFIRMAÇÃO -->
        <div id="confirmation-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center p-4">
             <div id="confirmation-modal" class="card max-w-md mx-auto text-center">
                <h2 class="text-2xl font-bold mb-4">Confirme seus Dados</h2>
                <p class="text-slate-600 mb-6">Por favor, verifique se suas informações estão corretas antes de finalizar a avaliação.</p>
                <div id="modal-student-info" class="text-left bg-slate-100 p-4 rounded-lg mb-6 space-y-2"></div>
                <div class="flex justify-between gap-4">
                    <button id="cancel-finish-btn" class="btn btn-secondary w-1/2">Cancelar</button>
                    <button id="confirm-finish-btn" class="btn btn-primary w-1/2">Finalizar Prova</button>
                </div>
            </div>
        </div>

        <!-- TELA DE BLOQUEIO -->
        <div id="locked-screen" class="hidden card max-w-lg mx-auto text-center">
            <h1 class="text-3xl font-bold mb-4">Dispositivo Bloqueado</h1>
            <p class="text-slate-600 mb-8">Esta estação de prova já foi utilizada. Peça ao professor para inserir a senha de administrador.</p>
            <button id="unlock-btn" class="btn btn-primary w-full">
                <hero-lock-open-solid class="w-5 h-5"></hero-lock-open-solid>
                Desbloquear Dispositivo
            </button>
        </div>

        <!-- Sidebar de Texto para Mobile (agora fora do quiz-screen para melhor controle) -->
        <div id="text-panel-mobile" class="fixed top-0 left-0 h-full w-4/5 max-w-sm bg-white shadow-lg p-6 overflow-y-auto z-30 transform -translate-x-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Texto de Apoio</h3>
                <button id="close-sidebar-btn" class="text-2xl text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="base-text-mobile" class="prose"></div>
        </div>
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    </div>

    <!-- Script principal da aplicação -->
    <script type="module" src="src/main.js"></script>
</body>
</html>