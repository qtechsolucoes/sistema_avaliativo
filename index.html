<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Avalia√ß√µes</title>

    <!--
    ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ATEN√á√ÉO ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

    N√ÉO ABRA ESTE ARQUIVO DIRETAMENTE (duplo clique)!

    Isso causar√° erro 404 em config.js porque m√≥dulos ES6
    n√£o funcionam com protocolo file://

    PARA USAR:
    1. Abra o terminal nesta pasta
    2. Execute: python -m http.server 8000
    3. Acesse: http://localhost:8000

    OU para Chromebooks:
    - Deploy online (Vercel/Netlify)
    - Veja: CHROMEBOOKS_SOLUCAO_RAPIDA.txt

    ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
    -->

    <!-- CDNs Externos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/heroicons@2.1.3/dist/solid/index.js" defer></script>
    
    <!-- Fontes e Estilos Locais -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">

    <!-- Estilos customizados para o quiz -->
    <style>
        /* Scrollbar customizada para o texto de apoio */
        #text-scroll-container::-webkit-scrollbar {
            width: 8px;
        }

        #text-scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        #text-scroll-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        #text-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #3b82f6;
        }

        /* Anima√ß√£o suave para o indicador de scroll */
        #scroll-hint {
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translateY(0);
            }
            40%, 43% {
                transform: translateY(-10px);
            }
            70% {
                transform: translateY(-5px);
            }
        }

        /* Melhora a legibilidade do texto */
        #base-text-desktop {
            line-height: 1.8;
            color: #374151;
        }

        #base-text-desktop p {
            margin-bottom: 1rem;
        }

        /* Layout responsivo otimizado */
        @media (max-width: 768px) {
            #quiz-screen {
                height: 100vh;
                max-height: none;
            }
        }

        /* Controle espec√≠fico de overflow */
        body.quiz-active {
            overflow: hidden;
            height: 100vh;
        }

        body.quiz-active #main-container {
            height: 100vh;
            overflow: hidden;
        }

        /* Garante que o quiz ocupe toda a tela */
        #quiz-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            padding: 1rem 2rem;
        }

        @media (max-width: 768px) {
            #quiz-screen {
                padding: 0.5rem;
            }
        }

        /* Apenas o container do texto deve ter scroll */
        #text-scroll-container {
            overflow-y: auto !important;
        }

        /* Remove qualquer scroll dos outros elementos */
        #quiz-screen .flex-col,
        #quiz-screen .flex,
        #options-container {
            overflow: visible !important;
        }

        /* Mant√©m estilo original das op√ß√µes */

        /* Estilos para jogos adaptativos */
        #adaptive-games-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .adaptive-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .adaptive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .game-item {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .game-item:hover {
            transform: scale(1.05);
        }

        .game-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-item.correct {
            background-color: #10b981;
            color: white;
        }

        .game-item.incorrect {
            background-color: #ef4444;
            color: white;
        }

        /* Adapta√ß√µes por tipo de necessidade */
        .adaptation-tea {
            --primary-color: #6366f1;
            --bg-color: #f8fafc;
        }

        .adaptation-tdah {
            --primary-color: #f59e0b;
            --bg-color: #fef3c7;
        }

        .adaptation-down {
            --primary-color: #ec4899;
            --bg-color: #fdf2f8;
        }

        .adaptation-intellectual {
            --primary-color: #10b981;
            --bg-color: #f0fdf4;
        }

        .adaptation-visual {
            --primary-color: #3b82f6;
            --bg-color: #dbeafe;
        }

        .adaptation-motor {
            --primary-color: #8b5cf6;
            --bg-color: #f3e8ff;
        }

        /* Estilos espec√≠ficos para cada tipo de adapta√ß√£o */
        body.adaptation-tea #adaptive-games-screen {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        }

        body.adaptation-tdah #adaptive-games-screen {
            background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%);
            animation: pulse 2s infinite;
        }

        body.adaptation-down #adaptive-games-screen {
            background: linear-gradient(135deg, #fdf2f8 0%, #fbcfe8 100%);
        }

        body.adaptation-intellectual #adaptive-games-screen {
            background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%);
        }

        body.adaptation-visual #adaptive-games-screen {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
        }

        body.adaptation-motor #adaptive-games-screen {
            background: linear-gradient(135deg, #f3e8ff 0%, #c4b5fd 100%);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* Responsividade para jogos adaptativos */
        @media (max-width: 768px) {
            #adaptive-game-container {
                padding: 10px;
            }

            .adaptive-card {
                margin: 5px;
                padding: 15px;
            }
        }

        /* ESTILOS DOS JOGOS ESPEC√çFICOS DO DEMO */
        .sequence-puzzle {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .sequence-item {
            aspect-ratio: 1;
            background: white;
            border: 3px solid #3b82f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .sequence-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .sequence-item.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }

        .sequence-item.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .rhythm-matching {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: start;
            margin: 20px 0;
        }

        .rhythm-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .rhythm-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #f59e0b;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .rhythm-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .rhythm-card.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .rhythm-card.matched {
            border-color: #10b981;
            background: #d1fae5;
            opacity: 0.7;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .memory-card {
            aspect-ratio: 1;
            background: #3b82f6;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .memory-card:hover {
            transform: scale(1.05);
        }

        .memory-card.flipped {
            background: white;
            color: #374151;
            border-color: #3b82f6;
        }

        .memory-card.matched {
            background: #10b981;
            border-color: #059669;
        }

        .classification-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .category-box {
            background: white;
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            min-height: 150px;
            transition: all 0.3s ease;
        }

        .category-box.drag-over {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .drag-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .drag-item {
            background: #f1f5f9;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            padding: 15px;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .drag-item:active {
            cursor: grabbing;
        }

        .drag-item:hover {
            transform: scale(1.05);
            border-color: #3b82f6;
        }

        /* Estilos espec√≠ficos para novos jogos */
        .sequence-game-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border-radius: 10px;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-weight: bold;
        }

        .sequence-progress {
            margin: 20px 0;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }

        .progress-text {
            margin-top: 5px;
            font-weight: bold;
        }

        .item-content {
            text-align: center;
        }

        .item-text {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-period {
            font-size: 0.8em;
            opacity: 0.7;
        }

        /* Rhythm Turbo Game */
        .rhythm-game-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 10px;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .stat {
            font-weight: bold;
            padding: 5px 10px;
            background: white;
            border-radius: 5px;
        }

        .vs-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .vs-text {
            font-size: 2em;
            font-weight: bold;
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .challenge-text {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #f59e0b;
        }

        .challenge-prompt {
            line-height: 1.4;
        }

        .challenge-movement, .challenge-rhythm {
            color: #3b82f6;
            font-weight: bold;
        }

        .movements-column, .rhythms-column {
            flex: 1;
        }

        .turbo-controls {
            text-align: center;
            margin-top: 20px;
        }

        .card-emoji {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .card-title {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .card-rhythm {
            font-size: 0.8em;
            opacity: 0.7;
        }

        .pattern-text {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>

</head>
<!-- CORRE√á√ÉO: Removidas as classes de layout do body -->
<body class="p-4 md:p-8">

    <!-- CORRE√á√ÉO: As classes de layout agora s√£o controladas aqui e pelo JS -->
    <div id="main-container" class="w-full">

        <!-- TELA DE IDENTIFICA√á√ÉO -->
        <div id="login-screen" class="card max-w-lg mx-auto w-full">
            <h1 class="text-3xl font-bold mb-2 text-center">Plataforma de Avalia√ß√µes</h1>
            <p class="text-slate-500 mb-8 text-center">Identifique-se para iniciar a sua prova.</p>
            <div class="space-y-5">
                <div>
                    <label for="year-select" class="font-semibold mb-2 block">1. Selecione seu Ano:</label>
                    <select id="year-select" class="form-select"><option value="">-- Selecione --</option></select>
                </div>
                <div>
                    <label for="class-select" class="font-semibold mb-2 block">2. Selecione sua Turma:</label>
                    <select id="class-select" class="form-select" disabled><option value="">-- Selecione o ano primeiro --</option></select>
                </div>
                <div>
                    <label for="student-select" class="font-semibold mb-2 block">3. Selecione seu Nome:</label>
                    <select id="student-select" class="form-select" disabled><option value="">-- Selecione a turma primeiro --</option></select>
                </div>
            </div>
            
            <div id="adaptation-legend" class="hidden student-adaptation-legend">
                <span class="icon">üéØ</span>
                <div>
                    <strong>Avalia√ß√£o Adaptada:</strong> Este estudante receber√° uma interface personalizada de acordo com suas necessidades espec√≠ficas.
                </div>
            </div>

            <div id="error-message-container" class="hidden mt-4 bg-red-100 text-red-700 p-3 rounded-lg text-sm border border-red-200"></div>
            <button id="start-btn" class="btn btn-primary w-full mt-8 text-base" disabled>
                <hero-play-solid class="w-5 h-5"></hero-play-solid>
                Iniciar Avalia√ß√£o
            </button>
            <div class="text-center mt-6">
                <a href="#" id="teacher-login-link" class="text-sm text-slate-500 hover:text-blue-600 transition">Acesso do Professor</a>
            </div>
        </div>

        <!-- TELA DA AVALIA√á√ÉO PADR√ÉO -->
        <div id="quiz-screen" class="hidden w-full h-full overflow-hidden">
            <div class="w-full h-full flex flex-col md:flex-row gap-4 overflow-hidden">
                <!-- Painel do Texto de Apoio -->
                <div class="w-full md:w-5/12 lg:w-4/12 h-full bg-white/60 rounded-xl hidden md:block relative">
                    <div class="p-6 pb-0">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            üìñ Texto de Apoio
                            <div class="text-sm bg-green-100 text-green-700 px-2 py-1 rounded-full font-normal">
                                üëÜ Role para ler
                            </div>
                        </h3>
                    </div>
                    <!-- Container do texto com scrollbar customizada -->
                    <div class="relative h-[calc(100%-80px)]">
                        <div id="text-scroll-container" class="h-full px-6 pb-6 overflow-y-auto scroll-smooth" style="scrollbar-width: thin; scrollbar-color: #cbd5e1 #f1f5f9;">
                            <div id="base-text-desktop" class="prose prose-sm max-w-none leading-relaxed"></div>
                        </div>
                        <!-- Seta animada para indicar scroll -->
                        <div id="scroll-hint" class="absolute bottom-4 right-8 bg-blue-500 text-white px-3 py-2 rounded-lg shadow-lg text-xs font-semibold animate-bounce">
                            ‚Üì Role o texto ‚Üì
                        </div>
                    </div>
                </div>

                <!-- Painel das Quest√µes (Sempre Vis√≠vel) -->
                <div class="w-full md:w-7/12 lg:w-8/12 h-full flex flex-col p-4 md:p-6 overflow-hidden">
                    <!-- Informa√ß√µes do Estudante (Fixo no topo) -->
                    <div id="student-info-display" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-slate-700 font-medium text-sm flex-shrink-0"></div>

                    <!-- Container das Quest√µes (Ocupa todo espa√ßo dispon√≠vel, sem scroll) -->
                    <div class="flex-grow flex flex-col justify-between overflow-hidden">
                        <!-- Cabe√ßalho da Quest√£o (Fixo) -->
                        <div class="flex-shrink-0 mb-4">
                            <p id="progress" class="text-sm text-slate-500 font-medium mb-2"></p>
                            <h2 id="question" class="font-bold leading-tight text-xl lg:text-2xl"></h2>
                        </div>

                        <!-- Op√ß√µes (Centralizadas e expandidas) -->
                        <div id="options-container" class="flex-grow flex flex-col justify-center gap-3 py-4"></div>

                        <!-- Controles (Fixo no rodap√©) -->
                        <div class="flex-shrink-0 pt-4">
                            <div id="feedback" class="text-base font-semibold min-h-[24px] mb-4"></div>
                            <div class="flex justify-between items-center">
                                <button id="open-sidebar-btn" class="btn btn-secondary md:hidden">
                                    <hero-document-text-solid class="w-5 h-5"></hero-document-text-solid> Ver Texto
                                </button>
                                <button id="next-btn" class="btn btn-primary ml-auto">Pr√≥xima Pergunta</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="warning-message" class="hidden fixed bottom-4 right-4 bg-red-100 text-red-800 px-4 py-3 rounded-lg shadow-lg z-50">
                <strong>Aten√ß√£o!</strong> Voc√™ saiu da tela da prova. Esta a√ß√£o foi registrada.
            </div>
        </div>

        <!-- NOVA TELA: AVALIA√á√ÉO DE ARRASTAR E SOLTAR -->
        <div id="drag-drop-screen" class="hidden card max-w-4xl mx-auto w-full">
            <h1 class="text-2xl font-bold mb-1 text-center">Atividade de Associa√ß√£o</h1>
            <p id="drag-drop-instruction" class="text-slate-500 mb-6 text-center">Arraste cada figura para a sua sombra correta.</p>
            <div class="grid grid-cols-2 gap-8 mt-8">
                <div id="drag-items-container" class="flex flex-col items-center justify-around gap-4 p-4 bg-slate-100 rounded-lg">
                </div>
                <div id="drop-targets-container" class="grid grid-cols-2 gap-4 p-4 border-2 border-dashed border-slate-300 rounded-lg">
                </div>
            </div>
            <p id="drag-drop-feedback" class="text-center font-semibold text-lg mt-6 min-h-[28px]"></p>
            <button id="drag-drop-next-btn" class="btn btn-primary w-full mt-4 hidden">Pr√≥ximo N√≠vel</button>
        </div>
        
        <!-- TELA DE JOGOS ADAPTATIVOS -->
        <div id="adaptive-games-screen" class="hidden w-full h-full">
            <!-- Container principal dos jogos adaptativos -->
            <div id="adaptive-game-container" class="w-full h-full flex flex-col">
                <!-- Cabe√ßalho do jogo -->
                <div id="adaptive-game-header" class="flex-shrink-0 p-4 bg-white/80 rounded-t-xl">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 id="adaptive-game-title" class="text-2xl font-bold"></h2>
                            <p id="adaptive-game-subtitle" class="text-slate-600"></p>
                        </div>
                        <div id="adaptive-game-info" class="text-right">
                            <div id="adaptive-game-score" class="text-lg font-semibold"></div>
                            <div id="adaptive-game-level" class="text-sm text-slate-500"></div>
                        </div>
                    </div>
                </div>

                <!-- √Årea do jogo -->
                <div id="adaptive-game-area" class="flex-grow p-4 overflow-hidden">
                    <!-- O conte√∫do do jogo ser√° inserido aqui dinamicamente -->
                </div>

                <!-- Controles do jogo -->
                <div id="adaptive-game-controls" class="flex-shrink-0 p-4 bg-white/80 rounded-b-xl">
                    <div class="flex justify-between items-center">
                        <div id="adaptive-game-feedback" class="text-lg font-semibold"></div>
                        <div class="flex gap-2">
                            <button id="adaptive-game-hint-btn" class="btn btn-secondary hidden">üí° Dica</button>
                            <button id="adaptive-game-next-btn" class="btn btn-primary hidden">Continuar</button>
                            <button id="adaptive-game-finish-btn" class="btn btn-primary hidden">Finalizar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TELA DE RESULTADOS -->
        <div id="results-screen" class="hidden card max-w-2xl mx-auto text-center">
            <h1 class="text-3xl font-bold mb-4">Avalia√ß√£o Finalizada!</h1>
            <p class="text-lg text-slate-600 mb-2">Voc√™ acertou:</p>
            <p id="score" class="text-6xl font-extrabold text-slate-800 mb-4"></p>
            <p class="text-2xl font-semibold text-slate-700 mb-8">Sua nota: <span id="decimal-score" class="text-blue-600 font-bold"></span></p>
            <div id="save-status" class="mb-6 text-sm"></div>
            <button id="back-to-start-btn" class="btn btn-primary w-full">
                <hero-arrow-left-start-on-rectangle-solid class="w-5 h-5"></hero-arrow-left-start-on-rectangle-solid>
                Voltar ao In√≠cio
            </button>
        </div>

        <!-- √ÅREA DO PROFESSOR -->
        <div id="teacher-area-screen" class="hidden card max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold mb-6 text-center">√Årea do Professor</h1>
            <div class="space-y-6">
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-document-arrow-down-solid class="w-6 h-6 mr-3 text-blue-600"></hero-document-arrow-down-solid>
                        1. Preparar Prova Offline
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Gere e baixe um arquivo HTML aut√¥nomo da prova para ser usado nos dispositivos sem internet.</p>
                    <button id="generate-test-file-btn" class="btn btn-secondary w-full">Gerar e Baixar Arquivo</button>
                </div>
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-arrows-right-left-solid class="w-6 h-6 mr-3 text-blue-600"></hero-arrows-right-left-solid>
                        2. Sincronizar Resultados
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Exporte ou importe arquivos de resultados para sincronizar os dados locais com o sistema online.</p>
                    <div class="flex gap-4">
                        <button id="export-results-btn" class="btn btn-secondary w-1/2">Exportar</button>
                        <button id="import-results-btn" class="btn btn-secondary w-1/2">Importar</button>
                        <input type="file" id="import-file-input" class="hidden" accept=".json">
                    </div>
                     <p id="sync-status" class="text-sm text-center mt-3 text-slate-500"></p>
                </div>
                <div class="p-5 border rounded-lg bg-slate-50/50">
                    <h2 class="text-xl font-semibold mb-2 flex items-center">
                        <hero-chart-pie-solid class="w-6 h-6 mr-3 text-blue-600"></hero-chart-pie-solid>
                        3. Painel de Desempenho
                    </h2>
                    <p class="text-sm text-slate-600 mb-4 pl-9">Acesse os gr√°ficos e a lista completa de resultados de todos os alunos sincronizados.</p>
                    <button id="view-dashboard-btn" class="btn btn-primary w-full">Acessar Painel</button>
                </div>
            </div>
             <button id="back-to-start-from-teacher-area-btn" class="text-sm text-slate-500 hover:text-blue-600 mt-8 block text-center transition">Voltar</button>
        </div>

        <!-- PAINEL DO PROFESSOR -->
        <div id="teacher-dashboard" class="hidden w-full">
            <div class="card w-full max-w-screen-2xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                     <h1 class="text-3xl font-bold">Painel de Desempenho</h1>
                     <button id="back-to-teacher-area-btn" class="text-sm text-slate-500 hover:text-blue-600 transition">Voltar para √Årea do Professor</button>
                </div>
                <div class="flex flex-col lg:flex-row gap-4 mb-6 bg-slate-50 p-4 rounded-xl border">
                    <div class="flex-1">
                        <label for="dashboard-year-filter" class="font-semibold mb-1 block text-sm">Filtrar por Ano:</label>
                        <select id="dashboard-year-filter" class="form-select"><option value="all">Todos os Anos</option></select>
                    </div>
                     <div class="flex-1">
                        <label for="dashboard-class-filter" class="font-semibold mb-1 block text-sm">Filtrar por Turma:</label>
                        <select id="dashboard-class-filter" class="form-select"><option value="all">Todas as Turmas</option></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 p-6 rounded-xl text-center border border-blue-100">
                        <h3 class="text-lg font-semibold text-blue-800">M√©dia Geral de Acertos</h3>
                        <p id="avg-score" class="text-4xl font-bold text-blue-900 mt-2">0%</p>
                    </div>
                    <div class="bg-green-50 p-6 rounded-xl text-center border border-green-100">
                        <h3 class="text-lg font-semibold text-green-800">Total de Provas Realizadas</h3>
                        <p id="total-assessments" class="text-4xl font-bold text-green-900 mt-2">0</p>
                    </div>
                    <div class="bg-yellow-50 p-6 rounded-xl text-center border border-yellow-100">
                        <h3 class="text-lg font-semibold text-yellow-800">Alunos √önicos Avaliados</h3>
                        <p id="total-students" class="text-4xl font-bold text-yellow-900 mt-2">0</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-xl font-bold mb-4 text-center">An√°lise de Acertos por Quest√£o</h3>
                        <canvas id="question-difficulty-chart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-xl font-bold mb-4 text-center">Tempo M√©dio por Quest√£o (segundos)</h3>
                        <canvas id="time-per-question-chart"></canvas>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-sm border col-span-1 lg:col-span-2">
                        <h3 class="text-xl font-bold mb-4 text-center">Distribui√ß√£o de Notas</h3>
                        <div class="max-w-md mx-auto">
                            <canvas id="score-distribution-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Resultados Individuais</h3>
                    <div class="overflow-x-auto border rounded-lg">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-sm">
                                <tr>
                                    <th class="p-3 font-semibold">Aluno</th>
                                    <th class="p-3 font-semibold">Avalia√ß√£o</th>
                                    <th class="p-3 font-semibold">Nota</th>
                                    <th class="p-3 font-semibold">Dura√ß√£o</th>
                                    <th class="p-3 font-semibold">Data</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body" class="text-slate-600"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE CONFIRMA√á√ÉO -->
        <div id="confirmation-modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden items-center justify-center p-4">
             <div id="confirmation-modal" class="card max-w-md mx-auto text-center">
                <h2 class="text-2xl font-bold mb-4">Confirme seus Dados</h2>
                <p class="text-slate-600 mb-6">Por favor, verifique se suas informa√ß√µes est√£o corretas antes de finalizar a avalia√ß√£o.</p>
                <div id="modal-student-info" class="text-left bg-slate-100 p-4 rounded-lg mb-6 space-y-2"></div>
                <div class="flex justify-between gap-4">
                    <button id="cancel-finish-btn" class="btn btn-secondary w-1/2">Cancelar</button>
                    <button id="confirm-finish-btn" class="btn btn-primary w-1/2">Finalizar Prova</button>
                </div>
            </div>
        </div>

        <!-- Sidebar de Texto para Mobile (agora fora do quiz-screen para melhor controle) -->
        <div id="text-panel-mobile" class="fixed top-0 left-0 h-full w-4/5 max-w-sm bg-white shadow-lg p-6 overflow-y-auto z-30 transform -translate-x-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Texto de Apoio</h3>
                <button id="close-sidebar-btn" class="text-2xl text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="base-text-mobile" class="prose"></div>
        </div>
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    </div>

    <!-- Script principal da aplica√ß√£o -->
    <script type="module" src="src/main.js" id="main-script"></script>

    <!-- Detector de erro de protocolo file:// -->
    <script>
        // Detecta se est√° usando file:// e mostra aviso
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('Failed to load module script')) {
                document.body.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-family: system-ui, -apple-system, sans-serif;
                        padding: 20px;
                        z-index: 999999;
                    ">
                        <div style="
                            background: white;
                            padding: 40px;
                            border-radius: 20px;
                            max-width: 600px;
                            text-align: center;
                            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        ">
                            <div style="font-size: 80px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                            <h1 style="color: #e53e3e; font-size: 32px; margin-bottom: 20px; font-weight: bold;">
                                ERRO: Arquivo Aberto Incorretamente
                            </h1>
                            <p style="color: #4a5568; font-size: 18px; margin-bottom: 30px; line-height: 1.6;">
                                Voc√™ abriu o <code style="background: #f7fafc; padding: 4px 8px; border-radius: 4px; color: #e53e3e;">index.html</code>
                                diretamente (duplo clique).
                                <br><br>
                                Isso n√£o funciona porque o sistema usa m√≥dulos ES6 que s√£o bloqueados no protocolo <code style="background: #f7fafc; padding: 4px 8px; border-radius: 4px; color: #e53e3e;">file://</code>
                            </p>

                            <div style="background: #edf2f7; padding: 20px; border-radius: 10px; margin-bottom: 30px; text-align: left;">
                                <h3 style="color: #2d3748; font-size: 20px; margin-bottom: 15px; font-weight: bold;">
                                    ‚úÖ Solu√ß√£o R√°pida:
                                </h3>
                                <ol style="color: #4a5568; font-size: 16px; line-height: 2; margin-left: 20px;">
                                    <li><strong>Feche esta janela</strong></li>
                                    <li>Duplo clique em: <code style="background: white; padding: 4px 8px; border-radius: 4px; color: #667eea; font-weight: bold;">INICIAR_SISTEMA.bat</code></li>
                                    <li>Acesse: <code style="background: white; padding: 4px 8px; border-radius: 4px; color: #667eea; font-weight: bold;">http://localhost:8000</code></li>
                                </ol>
                            </div>

                            <div style="background: #fff5f5; border: 2px solid #feb2b2; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                                <h3 style="color: #c53030; font-size: 16px; margin-bottom: 10px; font-weight: bold;">
                                    üì± Para Chromebooks:
                                </h3>
                                <p style="color: #742a2a; font-size: 14px; line-height: 1.5;">
                                    Chromebooks precisam do sistema hospedado online.<br>
                                    Leia: <strong>CHROMEBOOKS_SOLUCAO_RAPIDA.txt</strong>
                                </p>
                            </div>

                            <button onclick="location.reload()" style="
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                color: white;
                                border: none;
                                padding: 15px 40px;
                                font-size: 18px;
                                border-radius: 10px;
                                cursor: pointer;
                                font-weight: bold;
                                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üîÑ Recarregar (ap√≥s iniciar servidor)
                            </button>

                            <p style="color: #a0aec0; font-size: 12px; margin-top: 20px;">
                                Erro: ${e.message}
                            </p>
                        </div>
                    </div>
                `;
                e.preventDefault();
            }
        }, true);

        // Tamb√©m detecta se est√° usando file://
        if (window.location.protocol === 'file:') {
            setTimeout(() => {
                if (!document.querySelector('#login-screen')) { // Se n√£o carregou o sistema
                    document.body.innerHTML = `
                        <div style="
                            position: fixed;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-family: system-ui, -apple-system, sans-serif;
                            padding: 20px;
                        ">
                            <div style="
                                background: white;
                                padding: 40px;
                                border-radius: 20px;
                                max-width: 600px;
                                text-align: center;
                                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                            ">
                                <div style="font-size: 80px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                                <h1 style="color: #e53e3e; font-size: 28px; margin-bottom: 20px; font-weight: bold;">
                                    Sistema N√£o Pode Ser Aberto Diretamente
                                </h1>
                                <p style="color: #4a5568; font-size: 16px; margin-bottom: 30px; line-height: 1.6;">
                                    Voc√™ precisa usar um servidor web local ou hospedar online.
                                </p>
                                <div style="background: #edf2f7; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                                    <h3 style="color: #2d3748; font-size: 18px; margin-bottom: 15px; font-weight: bold;">
                                        üíª No seu computador:
                                    </h3>
                                    <p style="color: #4a5568; font-size: 14px; line-height: 1.8;">
                                        Duplo clique em: <code style="background: white; padding: 4px 8px; border-radius: 4px; color: #667eea; font-weight: bold;">INICIAR_SISTEMA.bat</code>
                                        <br>Depois acesse: <code style="background: white; padding: 4px 8px; border-radius: 4px; color: #667eea; font-weight: bold;">http://localhost:8000</code>
                                    </p>
                                </div>
                                <div style="background: #fffaf0; padding: 20px; border-radius: 10px; text-align: left;">
                                    <h3 style="color: #c05621; font-size: 18px; margin-bottom: 15px; font-weight: bold;">
                                        üì± Para Chromebooks:
                                    </h3>
                                    <p style="color: #744210; font-size: 14px; line-height: 1.8;">
                                        Duplo clique em: <code style="background: white; padding: 4px 8px; border-radius: 4px; color: #c05621; font-weight: bold;">DEPLOY_RAPIDO.bat</code>
                                        <br>Ou leia: <strong>CHROMEBOOKS_SOLUCAO_RAPIDA.txt</strong>
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }, 1000);
        }
    </script>
</body>
</html>